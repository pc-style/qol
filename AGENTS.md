# Repository Guidelines

Contributor guide for the QoL Userscript Framework.

## Project Structure & Module Organization

```
qol/
├── src/                    # Framework source code
│   ├── core/              # Core modules (ui, store, utils, deps, registry)
│   ├── styles.js          # Centralized CSS
│   └── index.js           # Main entry point
├── scripts/               # Individual userscript files (*.user.js)
├── tools/                 # Build and development tools
│   ├── new-script.js      # Script scaffolder
│   ├── check-scripts.js   # Script validator
│   ├── integrate.js       # Registry generator
│   └── build.js           # esbuild bundler
└── dist/                  # Build output (generated)
```

**Key locations:**
- Framework code: `src/core/` modules export functionality used by scripts
- Scripts: `scripts/*.user.js` files register via `QoL.registerScript()`
- Registry: `src/core/registry.js` is auto-generated by `integrate.js`

## Build, Test, and Development Commands

**Development:**
- `npm run new:script` - Interactive CLI to scaffold a new script template
- `npm run check:scripts` - Validate all scripts (syntax, IDs, structure)
- `npm run integrate` - Scan `scripts/` and regenerate `src/core/registry.js`
- `npm run build` - Bundle framework only → `dist/qol-framework.user.js`
- `npm run build:all` - Run `integrate` then build framework + all scripts

**Workflow:** Create script → `check:scripts` → `integrate` → `build:all`

## Coding Style & Naming Conventions

**JavaScript:**
- ES modules (`import`/`export`)
- Use `const`/`let`, avoid `var`
- Prefer async/await over callbacks
- Script IDs: lowercase with hyphens (`dark-mode-toggle`, not `darkModeToggle`)

**File naming:**
- Scripts: `{script-id}.user.js` (e.g., `markdown-converter.user.js`)
- Core modules: lowercase with hyphens (`ui.js`, `store.js`)

**Userscript headers:**
- Include `@require` pointing to framework: `https://raw.githubusercontent.com/pc-style/qol/main/dist/qol-framework.user.js`
- All scripts need: `@name`, `@namespace`, `@version`, `@description`, `@match`, `@grant`

**Code organization:**
- Scripts wrap functionality in `QoL.registerScript()` call
- Settings schema defines UI controls (see README.md for types)
- `init()` returns instance object for cleanup
- `destroy(instance)` handles cleanup

## Testing Guidelines

**Validation:**
- Run `npm run check:scripts` before committing
- Validates: script IDs, required fields, JavaScript syntax, `QoL.registerScript()` structure
- No duplicate script IDs allowed

**Manual testing:**
- Test scripts in Tampermonkey/Greasemonkey
- Verify settings UI renders correctly
- Test enable/disable functionality
- Check storage persistence

## Commit & Pull Request Guidelines

**Commit messages:**
- Format: `type: description` (e.g., `feat: add new script`, `fix: toolbar positioning`)
- Types: `feat`, `fix`, `refactor`, `docs`, `build`
- Keep descriptions concise and specific

**Pull requests:**
- Include description of changes
- Reference related issues if applicable
- Ensure `npm run check:scripts` passes
- Test in browser before submitting
- Update README.md if adding new features

**Adding a new script:**
1. Run `npm run new:script` or manually create `scripts/{id}.user.js`
2. Implement `QoL.registerScript()` with `init()` and `destroy()` hooks
3. Define settings schema if needed
4. Run `npm run check:scripts` to validate
5. Run `npm run build:all` to build
6. Test in browser

## Framework Integration

**Required in every script:**
- Framework check: `if (typeof QoL === 'undefined') return;`
- Script ID constant: `const SCRIPT_ID = 'script-id';`
- Registration: `QoL.registerScript({ id, name, description, settings, init, destroy })`

**Use framework APIs:**
- Storage: `QoL.store.get(id, key, default)` / `QoL.store.set(id, key, value)`
- Dependencies: `await QoL.deps.load('turndown')`
- UI: `QoL.ui.Toast.show(message)`, `QoL.ui.Modal.open(scriptId)`

**Settings schema:**
- Define in `settings` object with `type`, `default`, `label`
- Implement `getSetting(key)` and `setSetting(key, value)` methods
- Framework auto-generates form UI from schema

